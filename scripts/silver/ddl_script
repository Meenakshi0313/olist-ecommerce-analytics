/*
===============================================================================
DDL Script: Create Silver Tables
===============================================================================
Script Purpose:
    This script creates tables in the 'silver' schema, dropping existing tables 
    if they already exist.
	  Run this script to re-define the DDL structure of 'bronze' Tables
===============================================================================
*/


IF OBJECT_ID('silver.olist_customers_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_customers_dataset;
GO

CREATE TABLE silver.olist_customers_dataset (
    customer_id              NVARCHAR(50) NOT NULL PRIMARY KEY,       -- same as bronze
    customer_unique_id       NVARCHAR(50) NOT NULL,           -- used to track unique customers
    customer_zip_code_prefix INT NOT NULL,
    customer_city            NVARCHAR(100) NOT NULL,
    customer_state           NVARCHAR(2) NOT NULL
  );
  GO


  IF OBJECT_ID('silver.olist_geolocation_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_geolocation_dataset;
GO

  CREATE TABLE silver.olist_geolocation_dataset (
    geolocation_zip_code_prefix INT NOT NULL,
    geolocation_lat       DECIMAL(11,8) NOT NULL,       -- decimal for latitude/longitude
    geolocation_lng       DECIMAL(11,8) NOT NULL,
    geolocation_city            NVARCHAR(100) NOT NULL,
    geolocation_state           NVARCHAR(2) NOT NULL
);
GO


IF OBJECT_ID('silver.olist_order_items_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_order_items_dataset;
GO

CREATE TABLE silver.olist_order_items_dataset (
    order_id            NVARCHAR(50) NOT NULL,
    order_item_id       TINYINT NOT NULL,
    product_id          NVARCHAR(50) NOT NULL,
    seller_id           NVARCHAR(50) NOT NULL,
    shipping_limit_date DATETIME2 NOT NULL,
    price               DECIMAL(10,2) NOT NULL,
    freight_value       DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (order_id, order_item_id)
);
GO


IF OBJECT_ID('silver.olist_order_payments_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_order_payments_dataset;
GO

CREATE TABLE silver.olist_order_payments_dataset (
    order_id             NVARCHAR(50) NOT NULL,
    payment_sequential   TINYINT NOT NULL,
    payment_type         NVARCHAR(50) NOT NULL,
    payment_installments TINYINT NOT NULL,
    payment_value        DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (order_id, payment_sequential)
);
GO



IF OBJECT_ID('silver.olist_order_reviews_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_order_reviews_dataset;
GO

CREATE TABLE silver.olist_order_reviews_dataset (
    review_id               NVARCHAR(50) NOT NULL PRIMARY KEY,
    order_id                NVARCHAR(50) NOT NULL,
    review_score            TINYINT NOT NULL,
    review_comment_title    NVARCHAR(150) NULL,
    review_comment_message  NVARCHAR(1000) NULL,
    review_creation_date    DATETIME2 NOT NULL,
    review_answer_timestamp DATETIME2 NULL
);
GO


IF OBJECT_ID('silver.olist_orders_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_orders_dataset;
GO

CREATE TABLE silver.olist_orders_dataset (
    order_id                      NVARCHAR(50) NOT NULL PRIMARY KEY,
    customer_id                   NVARCHAR(50) NOT NULL,
    order_status                  NVARCHAR(50) NOT NULL,
    order_purchase_timestamp      DATETIME2 NOT NULL,
    order_approved_at             DATETIME2 NULL,
    order_delivered_carrier_date  DATETIME2 NULL,
    order_delivered_customer_date DATETIME2 NULL,
    order_estimated_delivery_date DATETIME2 NULL,
    carrier_before_approval_flag BIT   NULL ,
    delivered_before_carrier_flag BIT NULL
);
GO


IF OBJECT_ID('silver.olist_products_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_products_dataset;
GO

CREATE TABLE silver.olist_products_dataset (
    product_id                 NVARCHAR(50) NOT NULL PRIMARY KEY,
    product_category_name      NVARCHAR(100) NULL,
    product_name_length        INT NULL,
    product_description_length INT NULL,
    product_photos_qty         INT NULL,
    product_weight_g           INT NULL,
    product_length_cm          INT NULL,
    product_height_cm          INT NULL,
    product_width_cm           INT NULL
);
GO


IF OBJECT_ID('silver.olist_sellers_dataset', 'U') IS NOT NULL
    DROP TABLE silver.olist_sellers_dataset;
GO

CREATE TABLE silver.olist_sellers_dataset (
    seller_id              NVARCHAR(50) NOT NULL PRIMARY KEY,
    seller_zip_code_prefix INT NOT NULL,
    seller_city            NVARCHAR(100) NOT NULL,
    seller_state           NVARCHAR(2) NOT NULL
);
GO


IF OBJECT_ID('silver.product_category_name_translation', 'U') IS NOT NULL
    DROP TABLE silver.product_category_name_translation;
GO

CREATE TABLE silver.product_category_name_translation (
    product_category_name         NVARCHAR(100) NOT NULL PRIMARY KEY,
    product_category_name_english NVARCHAR(100) NOT NULL
);
GO
