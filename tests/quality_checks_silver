/*
===============================================================================
Silver Layer — Data Quality Validation Checks
===============================================================================

Purpose:
--------
This script validates the transformed data present in the Silver layer.
The Silver layer contains cleaned, standardized, and enriched datasets
derived from the Bronze (raw ingestion) layer.

The checks performed include:

• Row count validation
• Null value detection
• Duplicate detection
• Business rule validation
• Referential integrity validation
• Data range validation

These checks ensure the Silver layer is analytics-ready before being used
for Gold layer modeling and reporting.

===============================================================================
*/

------------------------------------------------------------
-- CUSTOMERS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) AS total_customers FROM silver.olist_customers_dataset;

-- Null Checks
SELECT *
FROM silver.olist_customers_dataset
WHERE customer_id IS NULL;

-- Duplicate Customer IDs
SELECT customer_id, COUNT(*) AS duplicate_count
FROM silver.olist_customers_dataset
GROUP BY customer_id
HAVING COUNT(*) > 1;


------------------------------------------------------------
-- GEOLOCATION TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_geolocation_dataset;

-- Invalid Coordinates
SELECT *
FROM silver.olist_geolocation_dataset
WHERE geolocation_lat NOT BETWEEN -90 AND 90
   OR geolocation_lng NOT BETWEEN -180 AND 180;


   ------------------------------------------------------------
-- ORDER ITEMS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_order_items_dataset;

-- Null Checks
SELECT *
FROM silver.olist_order_items_dataset
WHERE order_id IS NULL
   OR product_id IS NULL
   OR seller_id IS NULL;

-- Duplicate Business Keys
SELECT order_id, order_item_id, COUNT(*) AS duplicate_count
FROM silver.olist_order_items_dataset
GROUP BY order_id, order_item_id
HAVING COUNT(*) > 1;

-- Negative or Invalid Price
SELECT *
FROM silver.olist_order_items_dataset
WHERE price < 0
   OR freight_value < 0;


   ------------------------------------------------------------
-- ORDER PAYMENTS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_order_payments_dataset;

-- Null Checks
SELECT *
FROM silver.olist_order_payments_dataset
WHERE order_id IS NULL;

-- Invalid Payment Values
SELECT *
FROM silver.olist_order_payments_dataset
WHERE payment_value < 0;




------------------------------------------------------------
-- ORDER REVIEWS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_order_reviews_dataset;

-- Null Checks
SELECT *
FROM silver.olist_order_reviews_dataset
WHERE review_id IS NULL
   OR order_id IS NULL;

-- Invalid Review Scores
SELECT *
FROM silver.olist_order_reviews_dataset
WHERE review_score NOT BETWEEN 1 AND 5;


------------------------------------------------------------
-- ORDERS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_orders_dataset;

-- Null Checks
SELECT *
FROM silver.olist_orders_dataset
WHERE order_id IS NULL
   OR customer_id IS NULL;

-- Invalid Date Logic
SELECT *
FROM silver.olist_orders_dataset
WHERE order_purchase_timestamp > order_delivered_customer_date;


------------------------------------------------------------
-- PRODUCTS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_products_dataset;

-- Null Product IDs
SELECT *
FROM silver.olist_products_dataset
WHERE product_id IS NULL;

-- Invalid Dimensions
SELECT *
FROM silver.olist_products_dataset
WHERE product_weight_g < 0
   OR product_length_cm < 0
   OR product_height_cm < 0
   OR product_width_cm < 0;


   ------------------------------------------------------------
-- SELLERS TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.olist_sellers_dataset;

-- Null Seller IDs
SELECT *
FROM silver.olist_sellers_dataset
WHERE seller_id IS NULL;

-- Duplicate Sellers
SELECT seller_id, COUNT(*) AS duplicate_count
FROM silver.olist_sellers_dataset
GROUP BY seller_id
HAVING COUNT(*) > 1;


------------------------------------------------------------
-- PRODUCT CATEGORY TRANSLATION TABLE CHECKS
------------------------------------------------------------

-- Row Count
SELECT COUNT(*) FROM silver.product_category_name_translation;

-- Null Checks
SELECT *
FROM silver.product_category_name_translation
WHERE product_category_name IS NULL
   OR product_category_name_english IS NULL;

-- Duplicate Categories
SELECT product_category_name, COUNT(*) AS duplicate_count
FROM silver.product_category_name_translation
GROUP BY product_category_name
HAVING COUNT(*) > 1;



------------------------------------------------------------
-- REFERENTIAL INTEGRITY CHECKS
------------------------------------------------------------

-- Orders without Customers
SELECT o.*
FROM silver.olist_orders_dataset o
LEFT JOIN silver.olist_customers_dataset c
    ON o.customer_id = c.customer_id
WHERE c.customer_id IS NULL;

-- Order Items without Products
SELECT oi.*
FROM silver.olist_order_items_dataset oi
LEFT JOIN silver.olist_products_dataset p
    ON oi.product_id = p.product_id
WHERE p.product_id IS NULL;

-- Order Items without Sellers
SELECT oi.*
FROM silver.olist_order_items_dataset oi
LEFT JOIN silver.olist_sellers_dataset s
    ON oi.seller_id = s.seller_id
WHERE s.seller_id IS NULL;
